<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluaci√≥n de Madurez Digital - Versi√≥n Ejecutiva</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; color: #1a202c; }
        .app-container { max-width: 1100px; margin: 0 auto; background: white; border-radius: 24px; box-shadow: 0 25px 70px rgba(0,0,0,0.35); overflow: hidden; animation: slideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .header { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); color: white; padding: 50px 40px; text-align: center; position: relative; overflow: hidden; }
        .header::before { content: ''; position: absolute; top: 0; left: -100%; width: 200%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent); animation: shimmer 4s infinite; }
        @keyframes shimmer { 0% { left: -100%; } 100% { left: 100%; } }
        .header h1 { font-size: 2.5rem; font-weight: 900; margin-bottom: 12px; position: relative; z-index: 1; text-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .header .subtitle { font-size: 1.2rem; opacity: 0.95; font-weight: 500; position: relative; z-index: 1; }
        .badge { display: inline-block; background: rgba(255,255,255,0.25); padding: 8px 20px; border-radius: 20px; font-size: 0.9rem; margin-top: 15px; font-weight: 600; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.3); }
        .progress-section { background: linear-gradient(to bottom, #f8fafc, #ffffff); padding: 24px 40px; border-bottom: 1px solid #e2e8f0; }
        .progress-bar-container { background: #e2e8f0; height: 14px; border-radius: 20px; overflow: hidden; position: relative; box-shadow: inset 0 2px 4px rgba(0,0,0,0.06); }
        .progress-bar-fill { height: 100%; background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%); border-radius: 20px; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); position: relative; }
        .progress-bar-fill::after { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent); animation: progressShine 2s infinite; }
        @keyframes progressShine { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
        .progress-text { text-align: center; margin-top: 12px; font-weight: 700; color: #3b82f6; font-size: 1rem; }
        .content { padding: 40px; }
        .welcome-content { max-width: 700px; margin: 0 auto; }
        .welcome-content h2 { color: #1e3a8a; font-size: 2rem; font-weight: 800; text-align: center; margin-bottom: 20px; }
        .welcome-intro { font-size: 1.1rem; color: #475569; line-height: 1.8; text-align: center; margin-bottom: 30px; }
        .highlight-box { background: linear-gradient(135deg, #eff6ff 0%, #f0f9ff 100%); border-left: 5px solid #3b82f6; padding: 24px; border-radius: 12px; margin: 25px 0; }
        .highlight-box h3 { color: #1e3a8a; font-size: 1.3rem; font-weight: 700; margin-bottom: 12px; }
        .highlight-box ul { list-style: none; padding: 0; }
        .highlight-box li { padding: 8px 0 8px 28px; position: relative; line-height: 1.6; color: #334155; }
        .highlight-box li::before { content: "‚úì"; position: absolute; left: 0; color: #3b82f6; font-weight: 900; font-size: 1.2rem; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 700; color: #1e293b; font-size: 0.95rem; }
        .form-input { width: 100%; padding: 14px 18px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem; transition: all 0.3s; font-family: inherit; background: #f8fafc; }
        .form-input:focus { outline: none; border-color: #3b82f6; background: white; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1); }
        .dimension-header { background: linear-gradient(135deg, #f1f5f9 0%, #e0e7ff 100%); padding: 30px; border-radius: 16px; margin-bottom: 30px; border-left: 6px solid #3b82f6; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
        .dimension-header h2 { color: #1e3a8a; font-size: 1.8rem; font-weight: 900; margin-bottom: 10px; display: flex; align-items: center; gap: 12px; }
        .dimension-header p { color: #475569; line-height: 1.7; font-size: 1.05rem; }
        .question-card { background: white; border: 2px solid #e2e8f0; border-radius: 16px; padding: 28px; margin-bottom: 20px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .question-card:hover { border-color: #3b82f6; box-shadow: 0 8px 24px rgba(59, 130, 246, 0.15); transform: translateY(-2px); }
        .question-card.answered { border-color: #10b981; background: linear-gradient(135deg, #f0fdf4 0%, #ffffff 100%); }
        .question-header { display: flex; gap: 16px; margin-bottom: 20px; }
        .question-number { background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); color: white; min-width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 1.1rem; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); flex-shrink: 0; }
        .question-text { flex: 1; font-size: 1.1rem; line-height: 1.6; color: #1e293b; font-weight: 600; }
        .rating-options { display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 12px; }
        .rating-option input[type="radio"] { display: none; }
        .rating-label { display: flex; flex-direction: column; align-items: center; padding: 16px 10px; border: 2px solid #e2e8f0; border-radius: 12px; cursor: pointer; transition: all 0.3s; background: #fafafa; text-align: center; }
        .rating-label:hover { border-color: #3b82f6; background: #eff6ff; transform: translateY(-3px); box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2); }
        .rating-option input:checked + .rating-label { background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); color: white; border-color: #3b82f6; font-weight: 700; transform: scale(1.05); box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4); }
        .rating-value { font-size: 2rem; font-weight: 900; margin-bottom: 4px; }
        .rating-desc { font-size: 0.75rem; opacity: 0.9; font-weight: 600; }
        .btn { padding: 16px 36px; border: none; border-radius: 12px; font-size: 1.05rem; font-weight: 700; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; gap: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-transform: uppercase; letter-spacing: 0.5px; }
        .btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,0.2); }
        .btn:active:not(:disabled) { transform: scale(0.98); }
        .btn-primary { background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); color: white; }
        .btn-secondary { background: #64748b; color: white; }
        .btn-success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; }
        .navigation { display: flex; justify-content: space-between; margin-top: 40px; padding-top: 30px; border-top: 2px solid #e2e8f0; gap: 16px; }
        .score-hero { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); color: white; padding: 60px 40px; border-radius: 20px; text-align: center; margin-bottom: 40px; position: relative; overflow: hidden; box-shadow: 0 20px 60px rgba(30, 58, 138, 0.4); }
        .score-hero::before { content: ''; position: absolute; width: 400px; height: 400px; background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%); top: -200px; right: -200px; animation: float 6s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translate(0, 0); } 50% { transform: translate(-20px, 20px); } }
        .score-value { font-size: 6rem; font-weight: 900; margin: 20px 0; position: relative; z-index: 1; text-shadow: 0 4px 20px rgba(0,0,0,0.2); line-height: 1; }
        .score-label { font-size: 1.4rem; opacity: 0.95; font-weight: 600; position: relative; z-index: 1; }
        .level-badge { display: inline-block; padding: 14px 32px; background: rgba(255,255,255,0.25); border-radius: 30px; font-size: 1.5rem; font-weight: 800; margin-top: 20px; position: relative; z-index: 1; backdrop-filter: blur(10px); border: 2px solid rgba(255,255,255,0.4); }
        .dimensions-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; margin: 40px 0; }
        .dimension-result-card { background: white; border: 2px solid #e2e8f0; border-radius: 16px; padding: 28px; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .dimension-result-card:hover { transform: translateY(-4px); box-shadow: 0 12px 28px rgba(0,0,0,0.12); border-color: #3b82f6; }
        .dimension-result-card h3 { color: #1e3a8a; font-size: 1.15rem; font-weight: 800; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        .dimension-score { font-size: 3rem; font-weight: 900; background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin: 12px 0; }
        .dimension-bar { background: #e2e8f0; height: 14px; border-radius: 10px; overflow: hidden; margin-top: 16px; }
        .dimension-bar-fill { height: 100%; background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%); border-radius: 10px; transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        .roadmap-section { background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%); border-radius: 20px; padding: 40px; margin: 40px 0; border-left: 6px solid #10b981; box-shadow: 0 4px 16px rgba(16, 185, 129, 0.1); }
        .roadmap-section h3 { color: #065f46; font-size: 2rem; font-weight: 900; margin-bottom: 24px; display: flex; align-items: center; gap: 12px; }
        .roadmap-steps { display: grid; gap: 24px; }
        .roadmap-step { background: white; padding: 28px; border-radius: 16px; border-left: 5px solid #10b981; box-shadow: 0 2px 12px rgba(0,0,0,0.06); transition: all 0.3s; }
        .roadmap-step:hover { transform: translateX(8px); box-shadow: 0 4px 16px rgba(0,0,0,0.1); }
        .roadmap-step-number { display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border-radius: 50%; font-weight: 900; font-size: 1.2rem; margin-bottom: 12px; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); }
        .roadmap-step h4 { color: #065f46; font-size: 1.3rem; font-weight: 800; margin-bottom: 12px; }
        .roadmap-step p { color: #475569; line-height: 1.7; margin-bottom: 12px; }
        .roadmap-step ul { list-style: none; padding: 0; }
        .roadmap-step li { padding: 6px 0 6px 24px; position: relative; color: #334155; line-height: 1.6; }
        .roadmap-step li::before { content: "‚Üí"; position: absolute; left: 0; color: #10b981; font-weight: 900; }
        .action-buttons { display: flex; gap: 16px; justify-content: center; margin: 40px 0; flex-wrap: wrap; }
        .chart-container { background: white; border-radius: 20px; padding: 40px; margin: 40px 0; border: 2px solid #e2e8f0; box-shadow: 0 4px 16px rgba(0,0,0,0.06); }
        .chart-container h3 { text-align: center; color: #1e3a8a; font-size: 1.8rem; font-weight: 900; margin-bottom: 30px; }
        @media (max-width: 768px) { .header h1 { font-size: 1.8rem; } .content { padding: 24px; } .rating-options { grid-template-columns: repeat(3, 1fr); } .dimensions-grid { grid-template-columns: 1fr; } .score-value { font-size: 4rem; } .navigation { flex-direction: column; } .btn { width: 100%; justify-content: center; } }
        .scale-reference { background: #eff6ff; border: 2px solid #3b82f6; border-radius: 16px; padding: 20px; margin-bottom: 30px; }
        .scale-reference h4 { color: #1e3a8a; font-size: 1.1rem; font-weight: 800; margin-bottom: 16px; }
        .scale-items { display: grid; gap: 8px; }
        .scale-item { display: flex; align-items: center; gap: 12px; font-size: 0.9rem; color: #334155; }
        .scale-item-number { background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); color: white; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 900; flex-shrink: 0; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;
        const Chart = window.Chart;

        // Cuestionario y Datos (Mantenidos intactos)
        const questionsData = {
            "D1": {
                title: "Estrategia y Liderazgo Digital",
                description: "Visi√≥n estrat√©gica, compromiso del liderazgo y gobierno de la transformaci√≥n digital",
                icon: "üéØ",
                questions: [
                    "¬øExiste un plan estrat√©gico digital documentado, actualizado y alineado con la estrategia corporativa?",
                    "¬øLa alta direcci√≥n demuestra compromiso visible y asigna recursos (presupuesto 3-5% ingresos) a digitalizaci√≥n?",
                    "¬øExisten roles digitales formales con autoridad (CDO, CTO, VP Digital)?",
                    "¬øSe monitorean tendencias PropTech/ConTech y se realiza benchmark digital vs. competencia?",
                    "¬øExiste un roadmap de transformaci√≥n digital a 3-5 a√±os con objetivos medibles (KPIs)?",
                    "¬øPredomina una cultura de innovaci√≥n, experimentaci√≥n y tolerancia al error?",
                    "¬øSe comunican regularmente avances digitales y hay incentivos a la innovaci√≥n?"
                ]
            },
            "D2": {
                title: "Experiencia del Cliente Digital",
                description: "Capacidad de ofrecer experiencias digitales excepcionales en todo el journey del cliente",
                icon: "üè†",
                questions: [
                    "¬øEl sitio web es moderno, responsive, actualizado y ofrece informaci√≥n completa de proyectos?",
                    "¬øSe ofrecen experiencias inmersivas (tours virtuales 360¬∞, VR/AR, configuradores digitales)?",
                    "¬øExiste un CRM robusto para gesti√≥n de leads con seguimiento omnicanal (web, WhatsApp, email)?",
                    "¬øEl proceso de compra/reserva/separaci√≥n es mayormente digital con firma electr√≥nica?",
                    "¬øExiste app m√≥vil o portal digital para seguimiento de obra y postventa?",
                    "¬øLas comunicaciones son personalizadas basadas en datos del cliente?",
                    "¬øSe mide sistem√°ticamente satisfacci√≥n digital (NPS, CSAT) y se act√∫a sobre insights?"
                ]
            },
            "D3": {
                title: "Procesos y Tecnolog√≠a",
                description: "Digitalizaci√≥n de operaciones, herramientas implementadas e integraci√≥n tecnol√≥gica",
                icon: "‚öôÔ∏è",
                questions: [
                    "¬øSe usa BIM (Building Information Modeling) activamente en proyectos e integrado con gesti√≥n?",
                    "¬øExiste software especializado de gesti√≥n de construcci√≥n con control de obra en tiempo real?",
                    "¬øLa gesti√≥n de subcontratistas, proveedores, calidad y cambios es digital (no Excel/papel)?",
                    "¬øEl marketing est√° automatizado (email marketing, ads, retargeting, social media)?",
                    "¬øExiste un ERP implementado y utilizado activamente por >70% del equipo?",
                    "¬øLa facturaci√≥n es 100% electr√≥nica y tesorer√≠a/flujo de caja se gestionan digitalmente?",
                    "¬øLos sistemas clave est√°n integrados (APIs/integraciones nativas) con 'single source of truth'?",
                    "¬øSe usa cloud computing, hay protocolos de ciberseguridad robustos y backup autom√°tico?"
                ]
            },
            "D4": {
                title: "Datos e Inteligencia de Negocio",
                description: "Capacidad de capturar, analizar y usar datos para decisiones estrat√©gicas informadas",
                icon: "üìä",
                questions: [
                    "¬øExisten dashboards ejecutivos en tiempo real con KPIs clave del negocio?",
                    "¬øLa calidad de datos es alta, consistente y confiable para toma de decisiones?",
                    "¬øLas decisiones estrat√©gicas se basan en datos y anal√≠tica (no solo intuici√≥n)?",
                    "¬øSe usa anal√≠tica avanzada o predictiva (precios, demanda, riesgos, rentabilidad)?",
                    "¬øHay segmentaci√≥n inteligente de clientes y an√°lisis de tendencias de mercado?",
                    "¬øSe analiza rentabilidad detallada por proyecto con control de costos en tiempo real?"
                ]
            },
            "D5": {
                title: "Talento y Cultura Digital",
                description: "Disponibilidad de competencias digitales, programas de formaci√≥n y cultura de aprendizaje",
                icon: "üë•",
                questions: [
                    "¬øSe han evaluado brechas de competencias digitales con plan de capacitaci√≥n estructurado?",
                    "¬øHay presupuesto anual dedicado a formaci√≥n digital (>1% de payroll)?",
                    "¬øSe ejecutan programas activos de upskilling/reskilling en herramientas digitales clave?",
                    "¬øSe logra atraer, contratar y retener talento digital especializado?",
                    "¬øExiste knowledge management efectivo con cultura de aprendizaje continuo?",
                    "¬øEl equipo tiene certificaciones en herramientas clave (BIM, PMP, Agile, Data Analytics)?"
                ]
            },
            "D6": {
                title: "Innovaci√≥n y Modelo de Negocio",
                description: "Capacidad de innovar, experimentar con nuevas tecnolog√≠as y evolucionar el modelo de negocio",
                icon: "üöÄ",
                questions: [
                    "¬øExiste presupuesto dedicado a innovaci√≥n (0.5-2% de ingresos) gestionado activamente?",
                    "¬øSe usan metodolog√≠as √°giles (Scrum, Kanban, Design Thinking) en proyectos?",
                    "¬øSe ejecutan regularmente proyectos piloto con nuevas tecnolog√≠as (IA, IoT, blockchain)?",
                    "¬øHay alianzas activas con PropTech/ConTech, startups o universidades?",
                    "¬øSe exploran activamente nuevos modelos de negocio digitales?",
                    "¬øSe implementan tecnolog√≠as emergentes en proyectos (drones, impresi√≥n 3D, Smart Buildings)?",
                    "¬øLa velocidad de implementaci√≥n de innovaciones es alta con cultura de prototipado r√°pido (MVPs)?"
                ]
            }
        };

        const ratingScale = [
            { value: 0, label: "0", desc: "No existe" },
            { value: 1, label: "1", desc: "Conocido" },
            { value: 2, label: "2", desc: "Piloto" },
            { value: 3, label: "3", desc: "Parcial" },
            { value: 4, label: "4", desc: "Avanzado" },
            { value: 5, label: "5", desc: "√ìptimo" }
        ];

        // --- Funciones de L√≥gica y C√°lculo (Mantenidas sin cambios) ---

        const getLevel = (score) => {
            if (score < 20) return { level: 0, name: "Nivel 0: Inicial", color: "#dc2626", desc: "Sin estrategia digital, procesos manuales" };
            if (score < 40) return { level: 1, name: "Nivel 1: Emergente", color: "#ea580c", desc: "Conciencia digital, iniciativas aisladas" };
            if (score < 60) return { level: 2, name: "Nivel 2: Definido", color: "#eab308", desc: "Estrategia clara, herramientas implementadas" };
            if (score < 75) return { level: 3, name: "Nivel 3: Gestionado", color: "#3b82f6", desc: "Procesos optimizados, cultura digital" };
            if (score < 90) return { level: 4, name: "Nivel 4: Optimizado", color: "#10b981", desc: "Alta eficiencia, innovaci√≥n continua" };
            return { level: 5, name: "Nivel 5: Exponencial", color: "#8b5cf6", desc: "Digital-first, modelos disruptivos" };
        };

        const getRoadmap = (level) => {
            const roadmaps = {
                0: [
                    { step: 1, title: "Evaluaci√≥n del Estado Actual (Hecho ‚úì)", desc: "Ya completaste este paso con esta evaluaci√≥n. Ahora conoces tu punto de partida.", actions: ["Compartir resultados con equipo directivo", "Identificar 3 √°reas cr√≠ticas prioritarias"] },
                    { step: 2, title: "Definici√≥n de la Estrategia Digital (Prioridad URGENTE)", desc: "Establecer visi√≥n clara, prop√≥sito y asignar recursos.", actions: ["Designar un responsable de transformaci√≥n digital (CDO/VP Digital)", "Definir presupuesto inicial: 1-3% de ingresos anuales", "Crear comit√© de transformaci√≥n digital con sponsors ejecutivos", "Documentar visi√≥n digital a 3 a√±os con 5-7 objetivos SMART"] },
                    { step: 3, title: "Optimizaci√≥n Operativa (Primeros 90 d√≠as)", desc: "Quick wins digitales que generen credibilidad.", actions: ["Digitalizar 2 procesos cr√≠ticos (ej: CRM b√°sico + firma electr√≥nica)", "Implementar herramientas colaborativas (ej: Microsoft Teams/Slack)", "Capacitar en seguridad b√°sica (phishing, contrase√±as)"] }
                ],
                1: [
                    { step: 1, title: "Consolidaci√≥n de la Estrategia (Trimestre 1)", desc: "Formalizar la hoja de ruta digital y los recursos.", actions: ["Validar el Roadmap con la Junta Directiva.", "Asegurar la asignaci√≥n formal de presupuesto y equipo de T.D.", "Formalizar roles y responsabilidades digitales."] },
                    { step: 2, title: "Base de Tecnolog√≠a y Datos (Trimestre 2)", desc: "Establecer una base tecnol√≥gica y de datos s√≥lida y coherente.", actions: ["Integrar CRM y ERP para 'single source of truth'.", "Definir e implementar un protocolo de ciberseguridad b√°sico (backups, MFA).", "Invertir en formaci√≥n inicial en Data Analytics para liderazgo."] },
                    { step: 3, title: "Experiencia del Cliente Digital (Trimestre 3)", desc: "Digitalizar el journey del cliente de forma coherente.", actions: ["Implementar tours virtuales y configuradores en al menos el 50% de los proyectos.", "Automatizar el marketing (Email Marketing y Retargeting b√°sico).", "Establecer la medici√≥n sistem√°tica de NPS/CSAT digital."] }
                ],
                2: [
                    { step: 1, title: "Transformaci√≥n de Procesos Centrales (Trimestre 1-2)", desc: "Moverse de herramientas a la integraci√≥n de procesos (BIM).", actions: ["Adoptar BIM y crear est√°ndares internos de modelos.", "Implementar un software de gesti√≥n de obra en tiempo real.", "Digitalizar completamente la gesti√≥n de subcontratistas y proveedores."] },
                    { step: 2, title: "Cultura Digital y Talento (Trimestre 3)", desc: "Invertir en las personas que har√°n el cambio posible.", actions: ["Evaluar formalmente las brechas de competencias digitales por √°rea.", "Lanzar un programa de upskilling/reskilling formal y continuo.", "Alinear incentivos (bonos) a resultados de proyectos digitales."] },
                    { step: 3, title: "An√°lisis Predictivo B√°sico (Trimestre 4)", desc: "Usar datos para anticiparse en lugar de solo reaccionar.", actions: ["Crear dashboards ejecutivos que muestren tendencias y proyecciones (no solo hechos pasados).", "Modelar un an√°lisis b√°sico de rentabilidad por proyecto en tiempo real."] }
                ],
                3: [
                    { step: 1, title: "Adopci√≥n de IA/ML (Trimestre 1-2)", desc: "Experimentar con tecnolog√≠as avanzadas en √°reas de alto impacto.", actions: ["Lanzar 2-3 proyectos piloto con IA/ML (ej: gesti√≥n documental, lead scoring).", "Formalizar una metodolog√≠a √°gil (Scrum/Kanban) para nuevos proyectos digitales.", "Evaluar la implementaci√≥n de IA generativa para tareas de dise√±o/marketing."] },
                    { step: 2, title: "Modelo Operativo Digital (Trimestre 3)", desc: "Buscar la eficiencia m√°xima a trav√©s de la integraci√≥n total.", actions: ["Lograr una integraci√≥n total de sistemas (ERP, CRM, BIM, Gesti√≥n de Obra) v√≠a APIs.", "Implementar el portal de postventa digital para autoservicio del cliente.", "Optimizar el flujo de caja y la planificaci√≥n financiera con datos en tiempo real."] },
                    { step: 3, title: "Alianzas Estrat√©gicas (Trimestre 4)", desc: "Extender la innovaci√≥n m√°s all√° de las paredes de la empresa.", actions: ["Establecer alianzas activas con 2-3 startups PropTech/ConTech relevantes.", "Participar en consorcios o grupos de trabajo de innovaci√≥n sectorial.", "Incentivar un sandbox (entorno de pruebas) para la co-creaci√≥n con proveedores."] }
                ],
                4: [
                    { step: 1, title: "Ciberseguridad Avanzada y Gobernanza (Trimestre 1)", desc: "Blindar la operaci√≥n digital y formalizar la toma de decisiones.", actions: ["Implementar un marco de Gobernanza de Datos (Data Governance).", "Obtener certificaciones de ciberseguridad (ej: ISO 27001).", "Formalizar el uso de Cloud Computing como estrategia principal."] },
                    { step: 2, title: "Innovaci√≥n Disfruptiva (Trimestre 2-3)", desc: "Invertir en tecnolog√≠as que pueden cambiar el modelo de negocio.", actions: ["Lanzar un proyecto de exploraci√≥n en IOT (Sensores) o Smart Buildings/Homes.", "Destinar >1.5% de los ingresos a proyectos de Innovaci√≥n.", "Evaluar nuevos modelos de negocio (ej: PropTech, servicios de valor a√±adido digital)."] },
                    { step: 3, title: "Cultura Exponencial (Continuo)", desc: "Asegurar que la innovaci√≥n sea una funci√≥n de cada empleado.", actions: ["Crear un programa de embajadores digitales o intraemprendimiento.", "Revisar la estructura organizacional para que soporte la agilidad y la innovaci√≥n.", "Lograr que el 90% de las decisiones se tomen con apoyo de la anal√≠tica de datos."] }
                ],
                5: [
                    { step: 1, title: "Revisi√≥n Continua del Modelo de Negocio (Trimestral)", desc: "La digitalizaci√≥n es el n√∫cleo del modelo, no solo un soporte.", actions: ["Identificar el pr√≥ximo disruptor tecnol√≥gico (Web3, Realidad Extendida) y evaluar su impacto.", "Lanzar una spin-off o un nuevo negocio completamente digital.", "Realizar un benchmark contra l√≠deres globales de la industria cada 6 meses."] },
                    { step: 2, title: "Excelencia de Datos (Continuo)", desc: "Asegurar que la Inteligencia Artificial sea el motor de las decisiones.", actions: ["Implementar un sistema de Machine Learning para predecir precios, demanda y rentabilidad con alta precisi√≥n.", "Optimizar la experiencia del cliente para que sea 100% personalizada y proactiva.", "Automatizar el 75% de las tareas de gesti√≥n rutinarias."] },
                    { step: 3, title: "Atracci√≥n del Mejor Talento Global (Continuo)", desc: "Ser un referente en la industria para el talento digital.", actions: ["Establecer acuerdos de investigaci√≥n con universidades l√≠deres.", "Crear un programa de atracci√≥n de talento remoto global y especializado.", "Mantener el presupuesto de formaci√≥n/innovaci√≥n por encima del 3% de los ingresos."] }
                ]
            };
            return roadmaps[level.level] || roadmaps[0];
        };
        
        // --- Componentes ---

        const QuestionCard = ({ dim, qIndex, questionText, currentAnswer, handleAnswer }) => (
            <div className={`question-card ${currentAnswer !== undefined ? 'answered' : ''}`}>
                <div className="question-header">
                    <div className="question-number">{qIndex + 1}</div>
                    <p className="question-text">{questionText}</p>
                </div>
                <div className="rating-options">
                    {ratingScale.map((scale) => (
                        <label key={scale.value} className="rating-option">
                            <input
                                type="radio"
                                name={`q-${dim}-${qIndex}`}
                                value={scale.value}
                                checked={currentAnswer === scale.value}
                                onChange={() => handleAnswer(dim, qIndex, scale.value)}
                            />
                            <div className="rating-label">
                                <span className="rating-value">{scale.label}</span>
                                <span className="rating-desc">{scale.desc}</span>
                            </div>
                        </label>
                    ))}
                </div>
            </div>
        );

        const WelcomeScreen = ({ onStart, companyInfo, setCompanyInfo, setCurrentDim }) => {
            const isFormComplete = companyInfo.name && companyInfo.evaluator;

            return (
                <div className="content welcome-content">
                    <h2>üöÄ Evaluaci√≥n de Madurez Digital</h2>
                    <p className="welcome-intro">
                        Esta herramienta te ayudar√° a medir la **Madurez Digital** de tu empresa en 6 dimensiones clave.
                        Responde honestamente con la escala de 0 (No existe) a 5 (√ìptimo/L√≠der).
                    </p>

                    <div className="highlight-box">
                        <h3>Instrucciones R√°pidas</h3>
                        <ul>
                            <li>Solo 45 preguntas, aprox. 15-20 minutos.</li>
                            <li>Las respuestas se guardan autom√°ticamente.</li>
                            <li>Los resultados te dar√°n un *roadmap* de acci√≥n claro.</li>
                        </ul>
                    </div>
                    
                    <h3>Datos de la Evaluaci√≥n</h3>
                    <div className="form-group">
                        <label className="form-label" htmlFor="companyName">Nombre de la Empresa</label>
                        <input
                            id="companyName"
                            className="form-input"
                            type="text"
                            placeholder="Ej: Constructora Innova S.A."
                            value={companyInfo.name}
                            onChange={(e) => setCompanyInfo({ ...companyInfo, name: e.target.value })}
                        />
                    </div>
                    <div className="form-group">
                        <label className="form-label" htmlFor="evaluator">Evaluador / Rol</label>
                        <input
                            id="evaluator"
                            className="form-input"
                            type="text"
                            placeholder="Ej: Gerente General / CDO"
                            value={companyInfo.evaluator}
                            onChange={(e) => setCompanyInfo({ ...companyInfo, evaluator: e.target.value })}
                        />
                    </div>
                    <div className="form-group">
                        <label className="form-label">Fecha de Evaluaci√≥n</label>
                        <input
                            className="form-input"
                            type="date"
                            value={companyInfo.date}
                            onChange={(e) => setCompanyInfo({ ...companyInfo, date: e.target.value })}
                        />
                    </div>
                    
                    <div style={{ textAlign: 'center', marginTop: '30px' }}>
                        <button
                            className="btn btn-primary"
                            onClick={() => { setCurrentDim('D1'); onStart(); }}
                            disabled={!isFormComplete}
                        >
                            Iniciar Evaluaci√≥n (Comenzar con D1)
                        </button>
                    </div>
                </div>
            );
        };

        const FormScreen = ({ currentDim, setCurrentDim, answers, handleAnswer, setScreen, getProgress }) => {
            const dimensionsKeys = Object.keys(questionsData);
            const currentDimIndex = dimensionsKeys.indexOf(currentDim);
            const currentQuestions = questionsData[currentDim];
            const totalDims = dimensionsKeys.length;
            const nextDimKey = dimensionsKeys[currentDimIndex + 1];
            const prevDimKey = dimensionsKeys[currentDimIndex - 1];

            const currentAnswersCount = Object.keys(answers[currentDim] || {}).length;
            const isCurrentDimComplete = currentQuestions.questions.length === currentAnswersCount;
            const isLastDim = currentDimIndex === totalDims - 1;

            return (
                <div className="content">
                    <div className="dimension-header">
                        <h2>{currentQuestions.icon} {currentQuestions.title}</h2>
                        <p>{currentQuestions.description}</p>
                    </div>

                    <div className="scale-reference">
                        <h4>Escala de Puntuaci√≥n (0 a 5)</h4>
                        <div className="scale-items">
                            {ratingScale.map(scale => (
                                <div key={scale.value} className="scale-item">
                                    <div className="scale-item-number">{scale.label}</div>
                                    <span>{scale.desc}</span>
                                </div>
                            ))}
                        </div>
                    </div>

                    {currentQuestions.questions.map((qText, qIndex) => (
                        <QuestionCard
                            key={qIndex}
                            dim={currentDim}
                            qIndex={qIndex}
                            questionText={qText}
                            currentAnswer={answers[currentDim] ? answers[currentDim][qIndex] : undefined}
                            handleAnswer={handleAnswer}
                        />
                    ))}

                    <div className="navigation">
                        {prevDimKey && (
                            <button 
                                className="btn btn-secondary" 
                                onClick={() => setCurrentDim(prevDimKey)}
                            >
                                ‚Üê Anterior: {questionsData[prevDimKey].title}
                            </button>
                        )}

                        {!isLastDim && (
                            <button 
                                className="btn btn-primary" 
                                onClick={() => setCurrentDim(nextDimKey)}
                                disabled={!isCurrentDimComplete}
                            >
                                Siguiente: {questionsData[nextDimKey].title} ‚Üí
                            </button>
                        )}

                        {isLastDim && (
                            <button 
                                className="btn btn-success" 
                                onClick={() => getProgress() === 100 ? setScreen('results') : alert('Aseg√∫rate de responder todas las preguntas.')}
                                disabled={!isCurrentDimComplete}
                            >
                                Finalizar y Ver Resultados
                            </button>
                        )}
                    </div>
                </div>
            );
        };

        const RadarChart = ({ results }) => {
            const chartRef = useRef(null);
            const chartInstance = useRef(null);
            
            // Funci√≥n drawChart ahora local y estable
            const drawChart = useCallback(() => {
                const dimLabels = Object.keys(results.dimensions).map(key => questionsData[key].title.split(' ')[0]); // Usar solo la primera palabra para el radar
                const dataValues = Object.keys(results.dimensions).map(key => results.dimensions[key].percentage);

                if (chartInstance.current) {
                    chartInstance.current.destroy();
                }

                if (!chartRef.current || dataValues.length === 0) return;

                const ctx = chartRef.current.getContext('2d');
                chartInstance.current = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: dimLabels,
                        datasets: [{
                            label: 'Puntuaci√≥n % de Madurez',
                            data: dataValues,
                            backgroundColor: 'rgba(59, 130, 246, 0.4)',
                            borderColor: '#3b82f6',
                            pointBackgroundColor: '#3b82f6',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: '#3b82f6',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: { callbacks: { label: (context) => `${context.dataset.label}: ${context.raw.toFixed(1)}%` } }
                        },
                        scales: {
                            r: {
                                angleLines: { color: 'rgba(0, 0, 0, 0.1)' },
                                grid: { color: 'rgba(0, 0, 0, 0.1)' },
                                suggestedMin: 0,
                                suggestedMax: 100,
                                pointLabels: { font: { size: 14, weight: '600' }, color: '#1e293b' },
                                ticks: { stepSize: 20, callback: (value) => `${value}%` }
                            }
                        }
                    }
                });
            }, [results]); // Ahora solo depende de 'results' (la data que cambia)

            useEffect(() => {
                drawChart();
            }, [drawChart]); // Se ejecuta cuando la funci√≥n drawChart cambia (lo cual solo sucede si results cambia)

            return (
                <div className="chart-container">
                    <h3>An√°lisis de Madurez por Dimensi√≥n</h3>
                    <div style={{ height: '400px' }}>
                        <canvas ref={chartRef}></canvas>
                    </div>
                </div>
            );
        };

        const ResultsScreen = ({ results, companyInfo, getRoadmap, setScreen }) => {
            const roadmapSteps = getRoadmap(results.level);
            const formattedScore = results.normalizedScore.toFixed(1);

            const handleDownload = () => {
                alert('Funcionalidad de descarga de PDF o datos no implementada en esta versi√≥n simple. Usa la opci√≥n "Imprimir" del navegador para guardar como PDF.');
            };

            return (
                <div className="content">
                    <div className="score-hero" style={{ background: results.level.color }}>
                        <div className="subtitle">Reporte de Madurez Digital para: **{companyInfo.name}**</div>
                        <h1 className="score-value">{formattedScore}<span style={{ fontSize: '2rem', fontWeight: 500 }}>%</span></h1>
                        <div className="score-label">Puntuaci√≥n de Madurez General</div>
                        <div className="level-badge" style={{ backgroundColor: 'rgba(255, 255, 255, 0.4)' }}>{results.level.name}</div>
                        <div style={{ marginTop: '20px', fontSize: '1.05rem', opacity: 0.9 }}>
                            {results.level.desc}
                        </div>
                    </div>

                    <RadarChart results={results} />

                    <div className="dimensions-grid">
                        {Object.keys(results.dimensions).map(dimKey => {
                            const dimResult = results.dimensions[dimKey];
                            const dimData = questionsData[dimKey];
                            const dimScore = dimResult.percentage.toFixed(1);

                            return (
                                <div key={dimKey} className="dimension-result-card">
                                    <h3>{dimData.icon} {dimData.title}</h3>
                                    <div className="dimension-score">{dimScore}%</div>
                                    <div className="dimension-bar">
                                        <div className="dimension-bar-fill" style={{ width: `${dimScore}%` }}></div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    
                    <div className="roadmap-section">
                        <h3>{results.level.level < 5 ? "Pr√≥ximos Pasos Recomendados" : "Excelencia Continua"}</h3>
                        <p style={{ marginBottom: '30px', color: '#065f46', fontWeight: 500 }}>
                            Basado en tu nivel de madurez **{results.level.name}**, este es el *roadmap* sugerido para avanzar al siguiente nivel:
                        </p>
                        <div className="roadmap-steps">
                            {roadmapSteps.map((step, index) => (
                                <div key={index} className="roadmap-step">
                                    <div className="roadmap-step-number">Paso {step.step}</div>
                                    <h4>{step.title}</h4>
                                    <p>{step.desc}</p>
                                    <ul>
                                        {step.actions.map((action, i) => <li key={i}>{action}</li>)}
                                    </ul>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="action-buttons">
                        <button className="btn btn-secondary" onClick={() => window.print()}>
                            üñ®Ô∏è Imprimir Reporte
                        </button>
                        <button className="btn btn-primary" onClick={handleDownload}>
                            üíæ Exportar PDF (Simulado)
                        </button>
                        <button className="btn btn-primary" onClick={() => {
                             if(window.confirm('¬øEst√°s seguro de que quieres reiniciar la evaluaci√≥n? Todos los datos guardados se perder√°n.')){
                                localStorage.removeItem('maturityData');
                                setScreen('welcome');
                                window.location.reload();
                             }
                        }}>
                            üîÑ Reiniciar Evaluaci√≥n
                        </button>
                    </div>
                </div>
            );
        };

        // --- COMPONENTE PRINCIPAL (App) ---

        const App = () => {
            const [screen, setScreen] = useState('welcome');
            const [currentDim, setCurrentDim] = useState('D1');
            const [answers, setAnswers] = useState({});
            const [companyInfo, setCompanyInfo] = useState(() => {
                const saved = localStorage.getItem('maturityData');
                if (saved) {
                    const data = JSON.parse(saved);
                    return data.companyInfo || { name: '', date: new Date().toISOString().split('T')[0], evaluator: '' };
                }
                return { name: '', date: new Date().toISOString().split('T')[0], evaluator: '' };
            });
            
            // --- Handlers y C√°lculos definidos con useCallback para estabilidad ---
            
            // CORREGIDO: handleAnswer es estable
            const handleAnswer = useCallback((dim, idx, val) => {
                setAnswers(prev => ({
                    ...prev,
                    [dim]: { ...(prev[dim] || {}), [idx]: val }
                }));
            }, []);

            // calculateResults es estable
            const calculateResults = useCallback(() => {
                const results = {};
                let totalScore = 0;
                let maxScore = 0;

                Object.keys(questionsData).forEach(dim => {
                    const dimAnswers = answers[dim] || {};
                    const score = Object.values(dimAnswers).reduce((sum, val) => sum + val, 0);
                    const max = questionsData[dim].questions.length * 5;
                    
                    results[dim] = {
                        score,
                        maxScore: max,
                        percentage: max > 0 ? (score / max) * 100 : 0
                    };
                    
                    totalScore += score;
                    maxScore += max;
                });

                const normalizedScore = maxScore > 0 ? (totalScore / maxScore) * 100 : 0;
                const level = getLevel(normalizedScore);

                return { dimensions: results, totalScore, maxScore, normalizedScore, level };
            }, [answers]);

            // getProgress es estable
            const getProgress = useCallback(() => {
                const total = Object.keys(questionsData).reduce((sum, dim) => 
                    sum + questionsData[dim].questions.length, 0);
                const answered = Object.keys(questionsData).reduce((sum, dim) => 
                    sum + Object.keys(answers[dim] || {}).length, 0);
                return (answered / total) * 100;
            }, [answers]);

            // Guardado (OK, solo depende de answers y companyInfo)
            useEffect(() => {
                localStorage.setItem('maturityData', JSON.stringify({ answers, companyInfo }));
            }, [answers, companyInfo]);
            
            // --- Renderizado Condicional ---

            let currentScreen = null;
            const progress = getProgress();

            if (screen === 'welcome') {
                currentScreen = (
                    <WelcomeScreen 
                        onStart={() => setScreen('form')} 
                        companyInfo={companyInfo} 
                        setCompanyInfo={setCompanyInfo} 
                        setCurrentDim={setCurrentDim}
                    />
                );
            } else if (screen === 'form') {
                currentScreen = (
                    <>
                        <div className="header">
                            <h1 style={{fontSize: '1.6rem', marginBottom: '8px'}}>{companyInfo.name}</h1>
                            <span className="subtitle">Evaluaci√≥n en Curso: {questionsData[currentDim].title}</span>
                            <div className="progress-section">
                                <div className="progress-bar-container">
                                    <div className="progress-bar-fill" style={{ width: `${progress.toFixed(1)}%` }}></div>
                                </div>
                                <div className="progress-text">Progreso General: {progress.toFixed(1)}%</div>
                            </div>
                        </div>
                        <FormScreen 
                            currentDim={currentDim}
                            setCurrentDim={setCurrentDim}
                            answers={answers}
                            handleAnswer={handleAnswer}
                            setScreen={setScreen}
                            getProgress={getProgress}
                        />
                    </>
                );
            } else if (screen === 'results') {
                currentScreen = (
                    <ResultsScreen 
                        results={calculateResults()} 
                        companyInfo={companyInfo} 
                        getRoadmap={getRoadmap}
                        setScreen={setScreen}
                    />
                );
            }
            
            return (
                <div className="app-container">
                    {currentScreen}
                </div>
            );
        };
        
        // --- INICIALIZACI√ìN DE REACT ---
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);

    </script>
</body>
</html>
